<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visor BIM IFC</title>
  <style>
    body { margin: 0; display: flex; height: 100vh; font-family: Arial, sans-serif; }
    #sidebar { width: 260px; padding: 16px; border-right: 1px solid #ccc; box-sizing: border-box; }
    #viewer-container { flex: 1; position: relative; }
    canvas { width: 100%; height: 100%; display: block; }
    #status { margin-top: 12px; font-size: 14px; }
  </style>
</head>

<body>
  <div id="sidebar">
    <h2>Visor BIM</h2>
    <button id="load">Cargar modelo IFC</button>
    <p id="status">Estatus: esperandoâ€¦</p>
  </div>

  <div id="viewer-container"></div>

  <script type="module">
    import { IfcViewerAPI } from "https://esm.run/web-ifc-viewer@1.0.218";

    const container = document.getElementById("viewer-container");
    const status    = document.getElementById("status");
    const button    = document.getElementById("load");

    const viewer = new IfcViewerAPI({
      container,
      backgroundColor: new Uint8Array([255, 255, 255])
    });

    // ðŸ‘‡ Forzamos a usar el wasm desde un CDN, NO desde /app/.cache/...
    viewer.IFC.loader.ifcManager.setWasmPath("https://unpkg.com/web-ifc@0.0.47/");

    viewer.grid.setGrid();
    viewer.axes.setAxes();

    let model = null;

    button.onclick = async () => {
      status.textContent = "Estatus: cargando modelo.ifcâ€¦";
      try {
        const loaded = await viewer.IFC.loadIfcUrl("./modelo.ifc");
        model = loaded;
        if (model && typeof model.modelID !== "undefined") {
          viewer.camera.fitToSelection(model.modelID);
        }
        status.textContent = "Estatus: modelo cargado âœ…";
      } catch (err) {
        console.error("Error cargando IFC:", err);
        status.textContent = "Estatus: ERROR cargando modelo.ifc (ver consola)";
      }
    };
  </script>
</body>
</html>
